 <html>
<head>
  <meta charset=utf-8 />
  <title>Points Within</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <!-- Load Leaflet from CDN-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
  <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
  <style>
    body { margin:0; padding:0; }
    #map { position: absolute; top:0; bottom:0; right:0; left:350px; }
	.leaflet-bar {
		box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
		border-radius: 5px;
	}
	#tables {
		width: 350px;
	}
  </style>
</head>
<body>
<div id="map-container">
	<div id = "tables">
	<table width = "100px">
		<tr text-align = "center">
			<th></th>
			<th>lat</th>
			<th>long</th>
			<th>get from map</th>
			
		</tr>
		<tr>
			<td>Start</td>
			<td><input type="text" size = "8" id = 'startlat'></td>
			<td><input type="text" size = "8" id = 'startlng'></td>
			<td><input type="submit" size = "7"  onclick = "getstart()"></td>
			
		</tr>
		<tr>
			<td>End</td>
			<td><input type="text" size = "8" id = 'endlat'></td>
			<td><input type="text" size = "8" id = 'endlng'></td>
			<td><input type="submit" size = "7" onclick = "getend()"></td>
		</tr>
		<tr>
			<td colspan = "4" align = "center">Width buffer zone (meters)<td>
		</tr>
		<tr>
			<td colspan = "3"><input type = "text" size = "27" id = 'bwidth'></td>
			<td><input type="submit" onclick = "myline()"></td>
		<tr>
	</table><br>
	<p id = "sumpoints"></p>
	<table id = "jsoncontent"></table>
	</div>
	<div id="map"></div>
</div>
<script>


var dataPts = {
"type": "FeatureCollection",
"features": [
{ "type": "Feature", "properties": { "ID": 1, "Lat": 53.89179593, "Lng": -1.62117004, "Rating": 1 }, "geometry": { "type": "Point", "coordinates": [ -1.62117004, 53.89179593 ] } },
{ "type": "Feature", "properties": { "ID": 2, "Lat": 53.8747, "Lng": -1.6239166, "Rating": 3 }, "geometry": { "type": "Point", "coordinates": [ -1.6239166, 53.8747 ] } },
{ "type": "Feature", "properties": { "ID": 3, "Lat": 53.88086, "Lng": -1.556625, "Rating": 2 }, "geometry": { "type": "Point", "coordinates": [ -1.556625, 53.88086 ] } },
{ "type": "Feature", "properties": { "ID": 4, "Lat": 53.863, "Lng": -1.518173, "Rating": 3 }, "geometry": { "type": "Point", "coordinates": [ -1.518173, 53.863 ] } },
{ "type": "Feature", "properties": { "ID": 5, "Lat": 53.8707, "Lng": -1.607437133, "Rating": 1 }, "geometry": { "type": "Point", "coordinates": [ -1.607437133, 53.8707 ] } }
]}





////////////////
    var map = L.map('map').setView([53.88, -1.5], 11);

	omnivore.csv('airports.csv').addTo(map);
    //basemap
    var osm=new L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',{ 
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'});
    osm.addTo(map);
	
	var myline = function(){
		
		var slat, slng, elat, elng, bwidth;
		slat = parseFloat(document.getElementById('startlat').value);
		slng = parseFloat(document.getElementById('startlng').value);
		elat = parseFloat(document.getElementById('endlat').value);
		elng = parseFloat(document.getElementById('endlng').value);
		bwidth = parseFloat(document.getElementById('bwidth').value);
		
		if (slat == ""){
			alert("set start point");
		} else if (elat==""){
			alert("set end point");
		} else if (bwidth == ""){
			alert("set widt buffer zone")
		} else {
		var mline = turf.lineString([[slng, slat], [elng, elat]]);
		var mstyle = {
			"color": "#ff7800",
			"weight": 5,
			"opacity": 0.65
		};
		var mySearch = turf.buffer(mline, bwidth, {units: 'meters'});
		var searchPolyLayer = L.geoJSON();
		searchPolyLayer.addData(mySearch);
		L.geoJSON(mline, {
			style:mstyle
		}).addTo(map);
		
		searchPolyLayer.eachLayer(function(layer) {

			var coords = layer.feature.geometry.coordinates;

			var polygon = turf.polygon(coords);
			var polygon2 =L.geoJson(polygon, {color: 'red'}).addTo(map);            
			var ptsWithin4 = turf.within(myPts.toGeoJSON(), polygon2.toGeoJSON());
			document.getElementById('sumpoints').innerHTML = ( ptsWithin4.features.length +" points in this poly");

			document.getElementById("jsoncontent").innerHTML = "<tr><th>ID</th><th>Rating</th><th>Lat</th><th>lng</th></tr>";
  			ptsWithin4.features.forEach(function(entry) {
				document.getElementById("jsoncontent").innerHTML += "<tr><td>" + entry.properties.ID + "</td><td>" + entry.properties.Rating + "</td><td>" + entry.properties.Lat + "</td><td>" + entry.properties.Lng + "</td></tr>";
				});
			

			//alert(JSON.stringify(ptsWithin4));


    });
	};
	};


    var geojsonMarkerOptions = {
    radius: 8,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
    };

    var myPts = L.geoJSON(null, {
        pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng, geojsonMarkerOptions);
        }
    })

    myPts.addData(dataPts);


    myPts.addTo(map);


var getstart = function(){
		map.once('click', function(e) {
		//alert("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng);
		document.getElementById('startlat').value = e.latlng.lat;
		document.getElementById('startlng').value = e.latlng.lng;
		});
	
	return;
};
var getend = function(){

	map.once('click', function(e) {
		//alert("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng);
		document.getElementById('endlat').value = e.latlng.lat;
		document.getElementById('endlng').value = e.latlng.lng;
	});
	return false;
};
</script>
</body>
</html>